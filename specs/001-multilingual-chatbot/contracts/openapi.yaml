openapi: 3.0.3
info:
  title: Multilingual Docusaurus + RAG Chatbot API
  description: Translation and chat services for multilingual educational platform
  version: 1.0.0
servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://api.example.com
    description: Production server

paths:
  /api/v1/translate:
    post:
      summary: Translate text between supported languages
      description: Translates text using OpenRouter API with caching and rate limiting
      operationId: translate_text
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TranslateRequest'
      responses:
        '200':
          description: Successful translation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranslateResponse'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - api_key: []

  /api/v1/chat:
    post:
      summary: Chat with the RAG bot
      description: Send a message to the chatbot and receive a response in the same language
      operationId: chat_message
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Successful chat response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - api_key: []

components:
  schemas:
    TranslateRequest:
      type: object
      required:
        - text
        - target_language
      properties:
        text:
          type: string
          description: Text to translate (max 5000 characters)
          maxLength: 5000
          example: "Hello, how are you?"
        target_language:
          type: string
          description: Target language code (ISO 639-1)
          pattern: "^[a-z]{2}$"
          example: "ur"
        source_language:
          type: string
          description: Source language code, auto-detect if missing
          pattern: "^[a-z]{2}$"
          example: "en"
        context:
          type: string
          description: Domain hint for better translation ('robotics', 'ai', 'technical')
          enum: [robotics, ai, technical]
          example: "technical"

    TranslateResponse:
      type: object
      required:
        - translated_text
        - source_language
        - target_language
        - model
        - confidence
        - cached
      properties:
        translated_text:
          type: string
          description: The translated text
          example: "ہیلو، آپ کیسے ہیں؟"
        source_language:
          type: string
          description: Detected/confirmed source language
          example: "en"
        target_language:
          type: string
          description: Target language that was used
          example: "ur"
        model:
          type: string
          description: Model that performed the translation
          example: "mistralai/devstral-2512:free"
        confidence:
          type: number
          description: Confidence score of translation (0-1)
          minimum: 0
          maximum: 1
          example: 0.95
        cached:
          type: boolean
          description: Whether the result was from cache
          example: false

    ChatRequest:
      type: object
      required:
        - message
        - language
        - session_id
      properties:
        message:
          type: string
          description: User message text
          example: "Explain ROS 2 architecture"
        language:
          type: string
          description: Language code of the message
          pattern: "^[a-z]{2}$"
          example: "en"
        context:
          type: string
          description: Context from text selection
          example: "In the previous section, we learned about nodes"
        session_id:
          type: string
          description: Unique session identifier
          example: "session-12345"

    ChatResponse:
      type: object
      required:
        - response
        - language
      properties:
        response:
          type: string
          description: Bot response text
          example: "ROS 2 uses a DDS-based middleware for communication..."
        language:
          type: string
          description: Language of the response
          example: "en"
        sources:
          type: array
          description: Source documents used for response (RAG)
          items:
            type: object
            properties:
              title:
                type: string
              url:
                type: string
              content:
                type: string
        translated:
          type: boolean
          description: Whether the response was translated
          example: false

    ErrorResponse:
      type: object
      required:
        - error
        - error_code
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid language code"
        error_code:
          type: string
          description: Error code
          example: "INVALID_LANGUAGE"
        details:
          type: object
          description: Additional error details
          example: {"supported_languages": ["en", "ur", "ar", "es", "fr", "de", "zh", "ja"]}

    RateLimitResponse:
      type: object
      required:
        - error
        - error_code
        - retry_after
      properties:
        error:
          type: string
          description: Rate limit exceeded message
          example: "Rate limit exceeded"
        error_code:
          type: string
          description: Rate limit error code
          example: "RATE_LIMIT_EXCEEDED"
        retry_after:
          type: integer
          description: Seconds to wait before retrying
          example: 60

  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication